"use strict";(self.webpackChunkgreen_software_training=self.webpackChunkgreen_software_training||[]).push([[5629],{4137:(e,t,i)=>{i.d(t,{Zo:()=>p,kt:()=>c});var n=i(7294);function a(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function r(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function l(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?r(Object(i),!0).forEach((function(t){a(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):r(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function o(e,t){if(null==e)return{};var i,n,a=function(e,t){if(null==e)return{};var i,n,a={},r=Object.keys(e);for(n=0;n<r.length;n++)i=r[n],t.indexOf(i)>=0||(a[i]=e[i]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)i=r[n],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(a[i]=e[i])}return a}var s=n.createContext({}),u=function(e){var t=n.useContext(s),i=t;return e&&(i="function"==typeof e?e(t):l(l({},t),e)),i},p=function(e){var t=u(e.components);return n.createElement(s.Provider,{value:t},e.children)},g={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var i=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),m=u(i),c=a,d=m["".concat(s,".").concat(c)]||m[c]||g[c]||r;return i?n.createElement(d,l(l({ref:t},p),{},{components:i})):n.createElement(d,l({ref:t},p))}));function c(e,t){var i=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=i.length,l=new Array(r);l[0]=m;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:a,l[1]=o;for(var u=2;u<r;u++)l[u]=i[u];return n.createElement.apply(null,l)}return n.createElement.apply(null,i)}m.displayName="MDXCreateElement"},9487:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>g,frontMatter:()=>r,metadata:()=>o,toc:()=>u});var n=i(7462),a=(i(7294),i(4137));const r={sidebar_position:10},l="How to build custom container images",o={unversionedId:"users/how-to-build-container-images",id:"users/how-to-build-container-images",title:"How to build custom container images",description:"While official images are available, you can build your own container images using the provided Dockerfile for customization or optimization purposes.",source:"@site/docs/users/how-to-build-container-images.md",sourceDirName:"users",slug:"/users/how-to-build-container-images",permalink:"/users/how-to-build-container-images",draft:!1,editUrl:"https://github.com/Green-Software-Foundation/if-docs/edit/master/docs/users/how-to-build-container-images.md",tags:[],version:"current",sidebarPosition:10,frontMatter:{sidebar_position:10},sidebar:"tutorialSidebar",previous:{title:"How to use Impact Framework with Docker containers",permalink:"/users/how-to-use-containers"},next:{title:"How to deploy Impact Framework to Kubernetes",permalink:"/users/how-to-deploy-to-kubernetes"}},s={},u=[{value:"Building the Standard Container Image",id:"building-the-standard-container-image",level:2},{value:"Building Slim Images",id:"building-slim-images",level:2},{value:"Building Images with Pre-installed Plugins",id:"building-images-with-pre-installed-plugins",level:2},{value:"Using the with-plugins Dockerfile",id:"using-the-with-plugins-dockerfile",level:3},{value:"Adding Private Plugins",id:"adding-private-plugins",level:3},{value:"Customizing Base Images",id:"customizing-base-images",level:3},{value:"Building Slim Images with Pre-installed Plugins",id:"building-slim-images-with-pre-installed-plugins",level:3},{value:"Testing Custom Images",id:"testing-custom-images",level:2}],p={toc:u};function g(e){let{components:t,...i}=e;return(0,a.kt)("wrapper",(0,n.Z)({},p,i,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"how-to-build-custom-container-images"},"How to build custom container images"),(0,a.kt)("p",null,"While official images are available, you can build your own container images using the provided ",(0,a.kt)("inlineCode",{parentName:"p"},"Dockerfile")," for customization or optimization purposes."),(0,a.kt)("h2",{id:"building-the-standard-container-image"},"Building the Standard Container Image"),(0,a.kt)("p",null,"The repository includes a ",(0,a.kt)("inlineCode",{parentName:"p"},"Dockerfile")," for building your own container image:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"# Build the container image\n$ docker build -t myorg/if:v1.0.0 .\n")),(0,a.kt)("h2",{id:"building-slim-images"},"Building Slim Images"),(0,a.kt)("p",null,"The default container image includes the git command to enable installation of external plugins from git repositories such as GitHub at startup. If you don't need to install external plugins from git repositories during startup, you can create a slimmer container image without git:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"# Build custom image without git\n$ docker build -t myorg/if:v1.0.0-slim --build-arg PACKAGES= .\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("strong",{parentName:"p"},"Note"),": The absence of git does not affect the installation of npm packages.")),(0,a.kt)("p",null,"Example of using the slim image with npm packages:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"$ cat plugins-startup.txt\ncarbon-intensity-plugin\n\n$ docker run --rm -p 3000:3000 \\\n  -v $(pwd)/plugins-startup.txt:/app/plugins.txt \\\n  myorg/if:v1.0.0-slim\n")),(0,a.kt)("h2",{id:"building-images-with-pre-installed-plugins"},"Building Images with Pre-installed Plugins"),(0,a.kt)("p",null,"For production environments where fast startup is critical, you can build container images with external plugins pre-installed. This eliminates the plugin installation time during container startup."),(0,a.kt)("h3",{id:"using-the-with-plugins-dockerfile"},"Using the with-plugins Dockerfile"),(0,a.kt)("p",null,"A specialized ",(0,a.kt)("inlineCode",{parentName:"p"},"Dockerfile")," for building container images with external plugins is provided in the ",(0,a.kt)("inlineCode",{parentName:"p"},"with-plugins")," directory:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"# Create plugin list\n$ cat with-plugins/plugins.txt\ncarbon-intensity-plugin\nGreen-Software-Foundation/if-github-plugin\n\n# Build image with pre-installed plugins\n$ docker build -t myorg/if-with-plugins:v1.0.0 with-plugins\n")),(0,a.kt)("h3",{id:"adding-private-plugins"},"Adding Private Plugins"),(0,a.kt)("p",null,"If you need to install private plugins, create a ",(0,a.kt)("inlineCode",{parentName:"p"},"with-plugins/.npmrc")," file:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"$ cat with-plugins/plugins.txt\ndanuw/if-casdk-plugin\n\n$ cat with-plugins/.npmrc\n//npm.pkg.github.com/:_authToken=<YOUR_PERSONAL_ACCESS_TOKEN>\n@Green-Software-Foundation:registry=https://npm.pkg.github.com/\n\n$ docker build -t myorg/if-with-plugins:v1.0.0 with-plugins\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("strong",{parentName:"p"},"Security Note"),": The ",(0,a.kt)("inlineCode",{parentName:"p"},".npmrc")," file is only used during the build process and is not included in the final container image.")),(0,a.kt)("h3",{id:"customizing-base-images"},"Customizing Base Images"),(0,a.kt)("p",null,"You can customize the base images used in the build process:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"$ docker build -t myorg/if-with-plugins:v1.0.0 \\\n  --build-arg BUILDBASEIMAGE=myorg/if:v1.0.0 \\\n  --build-arg BASEIMAGE=node:20-slim \\\n  with-plugins\n")),(0,a.kt)("p",null,"Parameters:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"BUILDBASEIMAGE"),": Base image used for installing plugins (default: official IF image)"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"BASEIMAGE"),": Base image for the final container (default: ",(0,a.kt)("inlineCode",{parentName:"li"},"node:18-slim"),")")),(0,a.kt)("h3",{id:"building-slim-images-with-pre-installed-plugins"},"Building Slim Images with Pre-installed Plugins"),(0,a.kt)("p",null,"You can also create slim images without git while having pre-installed plugins:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"$ docker build -t myorg/if-with-plugins:v1.0.0-slim \\\n  --build-arg PACKAGES= \\\n  with-plugins\n")),(0,a.kt)("h2",{id:"testing-custom-images"},"Testing Custom Images"),(0,a.kt)("p",null,"Test your custom images to ensure they work correctly:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},'# Test API server functionality\n$ docker run --rm -p 3000:3000 myorg/if:v1.0.0 &\n$ curl -H "Content-Type: application/yaml" \\\n  --data-binary @test-manifest.yaml \\\n  http://localhost:3000/v1/run\n\n# Test CLI commands\n$ docker run --rm \\\n  -v $(pwd)/manifest.yaml:/app/manifest.yaml \\\n  myorg/if:v1.0.0 if-run -m manifest.yaml\n')))}g.isMDXComponent=!0}}]);