"use strict";(self.webpackChunkgreen_software_training=self.webpackChunkgreen_software_training||[]).push([[59],{4137:(e,n,t)=>{t.d(n,{Zo:()=>s,kt:()=>m});var i=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,i,a=function(e,n){if(null==e)return{};var t,i,a={},o=Object.keys(e);for(i=0;i<o.length;i++)t=o[i],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)t=o[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var p=i.createContext({}),u=function(e){var n=i.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},s=function(e){var n=u(e.components);return i.createElement(p.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},d=i.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,p=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),d=u(t),m=a,h=d["".concat(p,".").concat(m)]||d[m]||c[m]||o;return t?i.createElement(h,r(r({ref:n},s),{},{components:t})):i.createElement(h,r({ref:n},s))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,r=new Array(o);r[0]=d;var l={};for(var p in n)hasOwnProperty.call(n,p)&&(l[p]=n[p]);l.originalType=e,l.mdxType="string"==typeof e?e:a,r[1]=l;for(var u=2;u<o;u++)r[u]=t[u];return i.createElement.apply(null,r)}return i.createElement.apply(null,t)}d.displayName="MDXCreateElement"},8578:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>r,default:()=>c,frontMatter:()=>o,metadata:()=>l,toc:()=>u});var i=t(7462),a=(t(7294),t(4137));const o={sidebar_position:4},r="How to write an IMP file",l={unversionedId:"users/how-to-write-imps",id:"users/how-to-write-imps",title:"How to write an IMP file",description:"The Impact Framework receives all its configuration and input data in the form of an IMP file known as an IMP. To use the framework, you will need to write an IMP file and pass its path to the command line tool. This guide will help you to understand how to construct one of these files and use it to measure the energy and carbon usage of your app.",source:"@site/docs/users/how-to-write-imps.md",sourceDirName:"users",slug:"/users/how-to-write-imps",permalink:"/users/how-to-write-imps",draft:!1,editUrl:"https://github.com/Green-Software-Foundation/if-docs/edit/master/docs/users/how-to-write-imps.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"How to load plugins",permalink:"/users/how-to-import-plugins"},next:{title:"Exporting CSV file with `if-csv`",permalink:"/users/how-to-export-csv-file-with-if-csv"}},p={},u=[{value:"Structure of an IMP",id:"structure-of-an-imp",level:2},{value:"Project metadata",id:"project-metadata",level:3},{value:"Initialize",id:"initialize",level:3},{value:"Tree",id:"tree",level:3},{value:"Inputs",id:"inputs",level:3},{value:"More complex IMPs",id:"more-complex-imps",level:2},{value:"Complex pipelines",id:"complex-pipelines",level:3},{value:"Complex applications",id:"complex-applications",level:3},{value:"Choosing which plugins to run",id:"choosing-which-plugins-to-run",level:2},{value:"Adding real-life inputs",id:"adding-real-life-inputs",level:2},{value:"Running an IMP",id:"running-an-imp",level:2}],s={toc:u};function c(e){let{components:n,...t}=e;return(0,a.kt)("wrapper",(0,i.Z)({},s,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"how-to-write-an-imp-file"},"How to write an IMP file"),(0,a.kt)("p",null,"The Impact Framework receives all its configuration and input data in the form of an IMP file known as an IMP. To use the framework, you will need to write an IMP file and pass its path to the command line tool. This guide will help you to understand how to construct one of these files and use it to measure the energy and carbon usage of your app."),(0,a.kt)("h2",{id:"structure-of-an-imp"},"Structure of an IMP"),(0,a.kt)("p",null,"The basic structure of an IMP is as follows:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"name:\ndescription:\ntags:\ninitialize:\n  plugins:\n    <PLUGIN-NAME-HERE>:\n      method:\n      path:\ntree:\n  children:\n    child:\n      pipeline:\n        observe:\n        regroup:\n        compute:\n      defaults:\n      inputs:\n")),(0,a.kt)("h3",{id:"project-metadata"},"Project metadata"),(0,a.kt)("p",null,"The file starts with some metadata about the project. There are no strict specifications for what to put in these fields, they are for you to keep track of your IMP files and to help other users to understand your use case."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"name:\ndescription:\ntags:\n")),(0,a.kt)("h3",{id:"initialize"},"Initialize"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"initialize")," fields are where you specify each individual plugin that will be initialized in your pipeline. The plugins can be initialized in any order, but can only be invoked elsewhere in the IMP if they have been initialized first here. In each case, you will need to provide the ",(0,a.kt)("inlineCode",{parentName:"p"},"name"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"path")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"method")," (and ",(0,a.kt)("inlineCode",{parentName:"p"},"config")," if your plugin requires it):"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"initialize:\n  plugins:\n    sci-m:\n      path: ''\n      method:\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"The ",(0,a.kt)("inlineCode",{parentName:"li"},"name")," is the name you want this plugin instance to be recognized as by Impact Framework."),(0,a.kt)("li",{parentName:"ul"},"The ",(0,a.kt)("inlineCode",{parentName:"li"},"path")," defines where IF should look for the installed plugin. For example, for our standard library of plugins you would specify ",(0,a.kt)("inlineCode",{parentName:"li"},"builtin"),", for other installed plugins you use the name of the directory they are installed into in ",(0,a.kt)("inlineCode",{parentName:"li"},"node_modules"),"."),(0,a.kt)("li",{parentName:"ul"},"For the ",(0,a.kt)("inlineCode",{parentName:"li"},"method")," field, you should provide the name of the function exported by your plugin. For example, for the ",(0,a.kt)("inlineCode",{parentName:"li"},"sum")," plugin, the correct value is ",(0,a.kt)("inlineCode",{parentName:"li"},"Sum"),".")),(0,a.kt)("h3",{id:"tree"},"Tree"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"tree")," fields are where you define the various components of your application. Each component is defined as ",(0,a.kt)("inlineCode",{parentName:"p"},"children"),", where each ",(0,a.kt)("inlineCode",{parentName:"p"},"child"),"'s output is summed to give the overall impact. Each ",(0,a.kt)("inlineCode",{parentName:"p"},"child")," can have its own plugin pipeline and its own configuration, but when none is provided, it is inherited from the tree-level configuration."),(0,a.kt)("p",null,"In the following example, there is only one component but the plugin pipeline contains two plugins; ",(0,a.kt)("inlineCode",{parentName:"p"},"teads-curve")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"sci-m"),". Neither requires any ",(0,a.kt)("inlineCode",{parentName:"p"},"config")," data, but certain information is required in ",(0,a.kt)("inlineCode",{parentName:"p"},"inputs"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"tree:\n  children:\n    child:\n      pipeline:\n        observe:\n        regroup:\n        compute:\n          - teads-curve\n          - sci-m\n      defaults:\n      inputs:\n        - timestamp: '2023-11-02T10:35:31.820Z'\n          duration: 3600\n          total-embodied-emissions: 1533.12\n          time-reserved: 1\n          expected-lifespan: 3\n          resources-reserved: 1\n          total-resources: 8\n")),(0,a.kt)("h3",{id:"inputs"},"Inputs"),(0,a.kt)("p",null,"The most granular level of the IMP file are the ",(0,a.kt)("inlineCode",{parentName:"p"},"inputs"),". This is where you can add specific data for each ",(0,a.kt)("inlineCode",{parentName:"p"},"child"),". Inputs must always include a ",(0,a.kt)("inlineCode",{parentName:"p"},"timestamp")," and a ",(0,a.kt)("inlineCode",{parentName:"p"},"duration"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"inputs:\n  - timestamp: 2023-07-06T00:00\n    duration: 3600\n    cpu-util: 45\n")),(0,a.kt)("p",null,"You now have a simple IMP file that will use the plugin config and input data to run the ",(0,a.kt)("inlineCode",{parentName:"p"},"teads-curve")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"sci-m")," plugins. The output data will be appended to the IMP under a new ",(0,a.kt)("inlineCode",{parentName:"p"},"outputs")," field and saved as an output file."),(0,a.kt)("h2",{id:"more-complex-imps"},"More complex IMPs"),(0,a.kt)("h3",{id:"complex-pipelines"},"Complex pipelines"),(0,a.kt)("p",null,"Whilst the IMP file we looked at above works perfectly well, it will only return the most basic output data. Most users will want to calculate an SCI score, which implies a number of additional steps:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"operational-carbon")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"embodied-carbon")," must appear as inputs."),(0,a.kt)("li",{parentName:"ul"},"This means that ",(0,a.kt)("inlineCode",{parentName:"li"},"sci")," will need to be preceded by ",(0,a.kt)("inlineCode",{parentName:"li"},"sci-m")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"sci-o")," in the plugin pipeline."),(0,a.kt)("li",{parentName:"ul"},"In most cases, ",(0,a.kt)("inlineCode",{parentName:"li"},"sci-o")," will have to be preceded by ",(0,a.kt)("inlineCode",{parentName:"li"},"sci-e")," to ensure ",(0,a.kt)("inlineCode",{parentName:"li"},"energy")," is available to be piped to ",(0,a.kt)("inlineCode",{parentName:"li"},"sci-o"),"."),(0,a.kt)("li",{parentName:"ul"},"The inputs to ",(0,a.kt)("inlineCode",{parentName:"li"},"sci-e")," will most likely be coming from a plugin such as ",(0,a.kt)("inlineCode",{parentName:"li"},"teads-curve")," or ",(0,a.kt)("inlineCode",{parentName:"li"},"boavizta"),"."),(0,a.kt)("li",{parentName:"ul"},"The ",(0,a.kt)("inlineCode",{parentName:"li"},"sci")," plugin also requires ",(0,a.kt)("inlineCode",{parentName:"li"},"functional-unit")," information so it can convert the estimated ",(0,a.kt)("inlineCode",{parentName:"li"},"carbon")," into a useful unit."),(0,a.kt)("li",{parentName:"ul"},"You may also wish to grab your ",(0,a.kt)("inlineCode",{parentName:"li"},"input")," data by querying a metrics API on a virtual machine.")),(0,a.kt)("p",null,"The example below gives you the full pipeline implemented in an IMP. There are also several other executable example IMPs in ",(0,a.kt)("inlineCode",{parentName:"p"},"if/manifests/examples")," that you can run for yourself."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"name: pipeline-with-aggregate\ndescription: a full pipeline with the aggregate feature enabled\ntags:\naggregation:\n  metrics:\n    - 'carbon'\n  type: 'both'\ninitialize:\n  plugins:\n    'interpolate':\n      method: Interpolation\n      path: 'builtin'\n      config:\n        method: linear\n        x: [0, 10, 50, 100]\n        y: [0.12, 0.32, 0.75, 1.02]\n        input-parameter: 'cpu/utilization'\n        output-parameter: 'cpu-factor'\n      parameter-metadata:\n        inputs:\n          cpu/utilization:\n            description: refers to CPU utilization\n            unit: percentage\n            aggregation-method:\n              time: avg\n              component: avg\n        outputs:\n          cpu-factor:\n            description: the factor of cpu\n            unit: kWh\n            aggregation-method:\n              time: avg\n              component: avg\n    'cpu-factor-to-wattage':\n      method: Multiply\n      path: builtin\n      config:\n        input-parameters: ['cpu-factor', 'cpu/thermal-design-power']\n        output-parameter: 'cpu-wattage'\n      parameter-metadata:\n        inputs:\n          cpu-factor:\n            description: the factor of cpu\n            unit: kWh\n            aggregation-method:\n              time: avg\n              component: avg\n          cpu/thermal-design-power:\n            description: thermal design power for a processor\n            unit: kwh\n            aggregation-method:\n              time: avg\n              component: avg\n        outputs:\n          cpu-wattage:\n            description: cpu in Wattage\n            unit: wattage\n            aggregation-method:\n              time: sum\n              component: sum\n    'wattage-times-duration':\n      method: Multiply\n      path: builtin\n      config:\n        input-parameters: ['cpu-wattage', 'duration']\n        output-parameter: 'cpu-wattage-times-duration'\n    'wattage-to-energy-kwh':\n      method: Divide\n      path: 'builtin'\n      config:\n        numerator: cpu-wattage-times-duration\n        denominator: 3600000\n        output: cpu-energy-raw\n    'calculate-vcpu-ratio':\n      method: Divide\n      path: 'builtin'\n      config:\n        numerator: vcpus-total\n        denominator: vcpus-allocated\n        output: vcpu-ratio\n    'correct-cpu-energy-for-vcpu-ratio':\n      method: Divide\n      path: 'builtin'\n      config:\n        numerator: cpu-energy-raw\n        denominator: vcpu-ratio\n        output: cpu-energy-kwh\n    'sci-embodied':\n      path: 'builtin'\n      method: SciEmbodied\n    'operational-carbon':\n      method: Multiply\n      path: builtin\n      config:\n        input-parameters: ['cpu-energy-kwh', 'grid/carbon-intensity']\n        output-parameter: 'carbon-operational'\n    'sci':\n      path: 'builtin'\n      method: Sci\n      config:\n        functional-unit-time: 1 sec\n        functional-unit: requests # factor to convert per time to per f.unit\n      parameter-metadata:\n        inputs:\n          carbon:\n            description: an amount of carbon emitted into the atmosphere\n            unit: gCO2e\n            aggregation-method:\n              time: sum\n              component: sum\n          requests:\n            description: factor to convert per time to per f.unit\n            unit: number\n            aggregation-method:\n              time: sum\n              component: sum\n        outputs:\n          sci:\n            description: carbon expressed in terms of the given functional unit\n            unit: gCO2e\n            aggregation-method:\n              time: avg\n              component: sum\n    'sum-carbon':\n      path: 'builtin'\n      method: Sum\n      config:\n        input-parameters:\n          - carbon-operational\n          - embodied-carbon\n        output-parameter: carbon\n    'time-sync':\n      method: TimeSync\n      path: 'builtin'\n      config:\n        start-time: '2023-12-12T00:00:00.000Z'\n        end-time: '2023-12-12T00:01:00.000Z'\n        interval: 5\n        allow-padding: true\ntree:\n  children:\n    child-1:\n      pipeline:\n        observe:\n        regroup:\n          - cloud/region\n          - cloud/instance-type\n        compute:\n          - interpolate\n          - cpu-factor-to-wattage\n          - wattage-times-duration\n          - wattage-to-energy-kwh\n          - calculate-vcpu-ratio\n          - correct-cpu-energy-for-vcpu-ratio\n          - sci-embodied\n          - operational-carbon\n          - sum-carbon\n          - time-sync\n          # - sci\n      defaults:\n        cpu/thermal-design-power: 100\n        grid/carbon-intensity: 800\n        device/emissions-embodied: 1533.120 # gCO2eq\n        time-reserved: 3600 # 1hr in seconds\n        device/expected-lifespan: 94608000 # 3 years in seconds\n        vcpus-total: 8\n        vcpus-allocated: 1\n      inputs:\n        - timestamp: '2023-12-12T00:00:00.000Z'\n          cloud/instance-type: A1\n          cloud/region: uk-west\n          duration: 1\n          cpu/utilization: 10\n          requests: 10\n        - timestamp: '2023-12-12T00:00:01.000Z'\n          duration: 5\n          cpu/utilization: 20\n          cloud/instance-type: A1\n          cloud/region: uk-west\n          requests: 5\n        - timestamp: '2023-12-12T00:00:06.000Z'\n          duration: 7\n          cpu/utilization: 15\n          cloud/instance-type: A1\n          cloud/region: uk-west\n          requests: 15\n        - timestamp: '2023-12-12T00:00:13.000Z'\n          duration: 30\n          cloud/instance-type: A1\n          cloud/region: uk-west\n          cpu/utilization: 15\n          requests: 30\n")),(0,a.kt)("h3",{id:"complex-applications"},"Complex applications"),(0,a.kt)("p",null,"The IMP examples provided so far have only had a single component. However, Impact Framework can handle any number of nested ",(0,a.kt)("inlineCode",{parentName:"p"},"children"),"."),(0,a.kt)("p",null,"In this way, you can combine complex plugin pipelines and application architectures to calculate the energy and carbon outputs of complicated systems."),(0,a.kt)("h2",{id:"choosing-which-plugins-to-run"},"Choosing which plugins to run"),(0,a.kt)("p",null,"The plugins are designed to be composable, but they each have specific input requirements that must be met in order for the plugins to run correctly. For example, the ",(0,a.kt)("inlineCode",{parentName:"p"},"teads-curve")," plugin requires ",(0,a.kt)("inlineCode",{parentName:"p"},"cpu/thermal-design-power")," to be available in the IMP. If it is not there, the plugin cannot use it to calculate ",(0,a.kt)("inlineCode",{parentName:"p"},"cpu/energy"),"."),(0,a.kt)("p",null,"It is also possible to leapfrog some plugins if you have access to high-level data. For example, perhaps you already know the energy being used by your CPU. In this case, there is no need to run ",(0,a.kt)("inlineCode",{parentName:"p"},"teads-curve"),", you can simply provide ",(0,a.kt)("inlineCode",{parentName:"p"},"cpu/energy")," as an ",(0,a.kt)("inlineCode",{parentName:"p"},"input")," and omit ",(0,a.kt)("inlineCode",{parentName:"p"},"teads-curve")," from the plugin pipeline."),(0,a.kt)("p",null,"We have deliberately made the plugins modular and composable so that you can be creative in developing new plugins to replace those provided as part of IF."),(0,a.kt)("h2",{id:"adding-real-life-inputs"},"Adding real-life inputs"),(0,a.kt)("p",null,"The examples above already include inputs for the components. However, you may want to input real-life data into the IMP file."),(0,a.kt)("p",null,"There is no one-size-fits-all solution for getting data into the IMP file. This is because there are so many possible sources for your input data, all of which have their own particular requirements related to authorization, API request syntax and return types. Therefore, the approach taken by IF is to have specific plugins for specific services."),(0,a.kt)("p",null,"The recommended method for integrating data is to use the plugin system of the Impact Framework. You can either use an existing specific importer plugin or write your own."),(0,a.kt)("p",null,"There are already some community plugins available, including plugins for fetching data from Kubernetes, GCP, and third-party data aggregators like Datadog."),(0,a.kt)("p",null,"If there is no fitting plugin available yet, we encourage you to write and add one for your specific use case. See ",(0,a.kt)("a",{parentName:"p",href:"../developers/"},"developer documentation")," for more information on how to build a plugin."),(0,a.kt)("p",null,"If you already have external scripts you might have a look at the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/Green-Software-Foundation/if/blob/main/src/if-run/builtins/shell/README.md"},"shell plugin")," to integrate them with the Impact Framework."),(0,a.kt)("p",null,"If you just need data for testing purposes, you can use the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/Green-Software-Foundation/if/blob/main/src/if-run/builtins/mock-observations/README.md"},"mock-observation")," plugin."),(0,a.kt)("h2",{id:"running-an-imp"},"Running an IMP"),(0,a.kt)("p",null,"You run an IMP by providing its path to our command line tool and a path to save the results file to. You can run an IMP named ",(0,a.kt)("inlineCode",{parentName:"p"},"my-imp.yml")," using the following command:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"if-run --manifest my-imp.yml\n")))}c.isMDXComponent=!0}}]);