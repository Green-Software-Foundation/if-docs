"use strict";(self.webpackChunkgreen_software_training=self.webpackChunkgreen_software_training||[]).push([[107],{4137:(e,n,t)=>{t.d(n,{Zo:()=>m,kt:()=>c});var i=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function r(e,n){if(null==e)return{};var t,i,a=function(e,n){if(null==e)return{};var t,i,a={},o=Object.keys(e);for(i=0;i<o.length;i++)t=o[i],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)t=o[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var s=i.createContext({}),p=function(e){var n=i.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},m=function(e){var n=p(e.components);return i.createElement(s.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},u=i.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,m=r(e,["components","mdxType","originalType","parentName"]),u=p(t),c=a,h=u["".concat(s,".").concat(c)]||u[c]||d[c]||o;return t?i.createElement(h,l(l({ref:n},m),{},{components:t})):i.createElement(h,l({ref:n},m))}));function c(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,l=new Array(o);l[0]=u;var r={};for(var s in n)hasOwnProperty.call(n,s)&&(r[s]=n[s]);r.originalType=e,r.mdxType="string"==typeof e?e:a,l[1]=r;for(var p=2;p<o;p++)l[p]=t[p];return i.createElement.apply(null,l)}return i.createElement.apply(null,t)}u.displayName="MDXCreateElement"},9160:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>l,default:()=>d,frontMatter:()=>o,metadata:()=>r,toc:()=>p});var i=t(7462),a=(t(7294),t(4137));const o={sidebar_position:4},l="How to write a manifest file",r={unversionedId:"users/how-to-write-impls",id:"users/how-to-write-impls",title:"How to write a manifest file",description:"The Impact Framework receives all its configuration and input data in the form of a manifest file known as an impl (input-yaml). To use the framework, you will need to write an impl file and pass its path to the command line tool. This guide will help you to understand how to construct one of these files and use it to measure the energy and carbon usage of your app.",source:"@site/docs/users/how-to-write-impls.md",sourceDirName:"users",slug:"/users/how-to-write-impls",permalink:"/users/how-to-write-impls",draft:!1,editUrl:"https://github.com/Green-Software-Foundation/ief/docs/users/how-to-write-impls.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"How to load model plugins",permalink:"/users/how-to-import-plugins"},next:{title:"Developers",permalink:"/developers/"}},s={},p=[{value:"Structure of an <code>impl</code>",id:"structure-of-an-impl",level:2},{value:"Project metadata",id:"project-metadata",level:3},{value:"Initialize",id:"initialize",level:3},{value:"Graph",id:"graph",level:3},{value:"Inputs",id:"inputs",level:3},{value:"More complex <code>impls</code>",id:"more-complex-impls",level:2},{value:"Complex pipelines",id:"complex-pipelines",level:3},{value:"Complex applications",id:"complex-applications",level:3},{value:"Choosing which models to run",id:"choosing-which-models-to-run",level:2},{value:"Running an <code>impl</code>",id:"running-an-impl",level:2}],m={toc:p};function d(e){let{components:n,...t}=e;return(0,a.kt)("wrapper",(0,i.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"how-to-write-a-manifest-file"},"How to write a manifest file"),(0,a.kt)("p",null,"The Impact Framework receives all its configuration and input data in the form of a manifest file known as an ",(0,a.kt)("inlineCode",{parentName:"p"},"impl")," (input-yaml). To use the framework, you will need to write an ",(0,a.kt)("inlineCode",{parentName:"p"},"impl")," file and pass its path to the command line tool. This guide will help you to understand how to construct one of these files and use it to measure the energy and carbon usage of your app."),(0,a.kt)("h2",{id:"structure-of-an-impl"},"Structure of an ",(0,a.kt)("inlineCode",{parentName:"h2"},"impl")),(0,a.kt)("p",null,"The basic structure of an ",(0,a.kt)("inlineCode",{parentName:"p"},"impl")," is as follows: "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"name: \ndescription: \ntags: \ninitialize:\n  models:\n    - name: \n      model:\n      path: \ngraph:\n  children:\n    child:\n      pipeline:\n        - \n      config:\n      inputs:\n\n")),(0,a.kt)("h3",{id:"project-metadata"},"Project metadata"),(0,a.kt)("p",null,"The file starts with some metadata about the project. There are no strict specfications for what to put in these fields, they are for you to keep track of your manifest files and to help other users to understand your use case."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"name:\ndescription:\ntags:\n")),(0,a.kt)("h3",{id:"initialize"},"Initialize"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"initialize")," fields are where you specify each individual model that will be initialized in your pipeline. The models can be initialized in any order, but can only be invoked elsewhere in the ",(0,a.kt)("inlineCode",{parentName:"p"},"impl")," if they have been initialized first here. In each case, you will need to provide the name, path and model:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"initialize:\n    - name: sci-m\n      path: ''\n      model:\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"The ",(0,a.kt)("inlineCode",{parentName:"li"},"name")," is the exact model name as recognized by Impact Framework. You can check all the valid model names ",(0,a.kt)("a",{parentName:"li",href:"../src/util/models-universe.ts"},"here"),"."),(0,a.kt)("li",{parentName:"ul"},"The ",(0,a.kt)("inlineCode",{parentName:"li"},"path")," defines where IF should look for the installed model. For example, for our standard library of models you would specify ",(0,a.kt)("inlineCode",{parentName:"li"},'"@grnsft/if-models"'),", as this is the name of the directory they are installed into in ",(0,a.kt)("inlineCode",{parentName:"li"},"node_modules"),"."),(0,a.kt)("li",{parentName:"ul"},"For the ",(0,a.kt)("inlineCode",{parentName:"li"},"model")," field, you should provide the name of the class your model instantiates. For example, for the ",(0,a.kt)("inlineCode",{parentName:"li"},"sci-e")," model, the correct value is ",(0,a.kt)("inlineCode",{parentName:"li"},"SciEModel"),".")),(0,a.kt)("h3",{id:"graph"},"Graph"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"graph")," fields are where you define the various components of your application. Each component is defined as ",(0,a.kt)("inlineCode",{parentName:"p"},"children"),", where each ",(0,a.kt)("inlineCode",{parentName:"p"},"child"),"'s output is summed to give the overall impact. Each ",(0,a.kt)("inlineCode",{parentName:"p"},"child")," can have its own model pipeline and its own configuration, but when none is provided, it is inherited from the graph-level configuration."),(0,a.kt)("p",null,"In the following example, there is only one component but the model pipeline contains two models; ",(0,a.kt)("inlineCode",{parentName:"p"},"teads-curve")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"sci-m"),". Neither requires any ",(0,a.kt)("inlineCode",{parentName:"p"},"config")," data, but certain information is required in ",(0,a.kt)("inlineCode",{parentName:"p"},"inputs"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"graph:\n  children:\n    child:\n      pipeline:\n        - teads-curve\n        - sci-m\n      config:\n      inputs:\n        - timestamp: '2023-11-02T10:35:31.820Z'\n          duration: 3600\n          total-embodied-emissions: 1533.12\n          time-reserved: 1\n          expected-lifespan: 3\n          resources-reserved: 1\n          total-resources: 8\n\n")),(0,a.kt)("h3",{id:"inputs"},"Inputs"),(0,a.kt)("p",null,"The most granular level of the manifest file are the ",(0,a.kt)("inlineCode",{parentName:"p"},"inputs"),". This is where you can add specific data for each ",(0,a.kt)("inlineCode",{parentName:"p"},"child"),". Inputs must always include a ",(0,a.kt)("inlineCode",{parentName:"p"},"timestamp")," and a ",(0,a.kt)("inlineCode",{parentName:"p"},"duration"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"inputs:\n  - timestamp: 2023-07-06T00:00\n    duration: 3600\n    cpu-util: 45\n")),(0,a.kt)("p",null,"You now have a simple ",(0,a.kt)("inlineCode",{parentName:"p"},"impl")," file that will use the model config and input data to run the ",(0,a.kt)("inlineCode",{parentName:"p"},"teads-curve")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"sci-m")," models. The output data will be appended to the ",(0,a.kt)("inlineCode",{parentName:"p"},"impl")," under a new ",(0,a.kt)("inlineCode",{parentName:"p"},"outputs")," field and saved as an ",(0,a.kt)("inlineCode",{parentName:"p"},"ompl")," file."),(0,a.kt)("h2",{id:"more-complex-impls"},"More complex ",(0,a.kt)("inlineCode",{parentName:"h2"},"impls")),(0,a.kt)("h3",{id:"complex-pipelines"},"Complex pipelines"),(0,a.kt)("p",null,"Whilst the ",(0,a.kt)("inlineCode",{parentName:"p"},"impl")," file we looked at above works perfectly well, it will only return the most basic output data. Most users will want to calculate an SCI score, which implies a number of additional steps:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"operational-carbon")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"embodied-carbon")," must appear as inputs."),(0,a.kt)("li",{parentName:"ul"},"This means that ",(0,a.kt)("inlineCode",{parentName:"li"},"sci")," will need to be preceded by ",(0,a.kt)("inlineCode",{parentName:"li"},"sci-m")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"sci-o")," in the model pipeline."),(0,a.kt)("li",{parentName:"ul"},"In most cases, ",(0,a.kt)("inlineCode",{parentName:"li"},"sci-o")," will have to be preceded by ",(0,a.kt)("inlineCode",{parentName:"li"},"sci-e")," to ensure ",(0,a.kt)("inlineCode",{parentName:"li"},"energy")," is available to be piped to ",(0,a.kt)("inlineCode",{parentName:"li"},"sci-o"),"."),(0,a.kt)("li",{parentName:"ul"},"The inputs to ",(0,a.kt)("inlineCode",{parentName:"li"},"sci-e")," will most likely be coming from a model such as ",(0,a.kt)("inlineCode",{parentName:"li"},"teads-curve"),"."),(0,a.kt)("li",{parentName:"ul"},"The ",(0,a.kt)("inlineCode",{parentName:"li"},"sci")," model also requires ",(0,a.kt)("inlineCode",{parentName:"li"},"functional-unit")," information so it can convert the estimated ",(0,a.kt)("inlineCode",{parentName:"li"},"carbon")," into a useful unit."),(0,a.kt)("li",{parentName:"ul"},"You may also wish to grab your ",(0,a.kt)("inlineCode",{parentName:"li"},"input")," data by querying a metrics API on a virtual machine. ")),(0,a.kt)("p",null,"The example below gives you the full pipeline implemented in an ",(0,a.kt)("inlineCode",{parentName:"p"},"impl")," (if you have an Azure virtual machine and put your credentials into a ",(0,a.kt)("inlineCode",{parentName:"p"},".env")," file, you can run this ",(0,a.kt)("inlineCode",{parentName:"p"},"impl")," to retrieve your SCI score)."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'name: if-demo\ndescription: demo pipeline\ntags:\ninitialize:\n  models:\n    - name: azure-importer\n      model: AzureImporterModel\n      path: "@grnsft/"@grnsft/"@grnsft/if-models"""\n    - name: cloud-instance-metadata\n      model: CloudInstanceMetadataModel\n      path: if-models\n    - name: teads-curve\n      model: TeadsCurveModel\n      path: if-unofficial-models\n    - name: sci-e\n      model: SciEModel\n      path: if-models\n    - name: sci-o\n      model: SciOModel\n      path: "@grnsft/if-models"\n    - name: sci-e\n      model: SciEModel\n      path: "@grnsft/if-models"\n    - name: sci-m\n      model: SciMModel\n      path: "@grnsft/if-models"\n    - name: sci\n      model: SciModel\n      path: "@grnsft/if-models"\ngraph:\n  children:\n    child:\n      pipeline:\n        - azure-importer\n        - cloud-instance-metadata\n        - teads-curve\n        - sci-e\n        - sci-o\n        - sci-m\n        - sci\n      config:\n        sci-o:\n          grid-carbon-intensity: 951\n        sci:\n          functional-unit: \'\'\n          functional-unit-time: hour\n          functional-unit-duration: 1\n      inputs:\n          - timestamp: \'2023-11-02T10:35:31.820Z\'\n            duration: 3600\n            azure-observation-window: 5 min # value and unit must be space separated \n            azure-observation-aggregation: \'average\'\n            azure-subscription-id: 9ed7b18c-8a28-5b73-9451-45fc74e7d0d3\n            azure-resource-group: vm1_group\n            azure-vm-name: vm1\n            total-embodied-emissions: 1533.12\n            time-reserved: 300\n            expected-lifespan: 94348800 # 3 yrs in seconds\n            resources-reserved: 1\n            total-resources: 64\n\n')),(0,a.kt)("h3",{id:"complex-applications"},"Complex applications"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"impl")," examples provided so far have only had a single component. However, Impact Framework can handle any number of nested ",(0,a.kt)("inlineCode",{parentName:"p"},"children"),".\nThe following example shows you how to nest multiple subcomponents. "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'name: nesting-demo\ndescription:\ntags:\n  kind: web\n  complexity: moderate\n  category: on-premise\ninitialize:\n  models:\n    - name: teads-curve\n      model: TeadsCurveModel\n      path: "@grnsft/if-unofficial-models"\n    - name: sci-e\n      model: SciEModel\n      path: "@grnsft/if-models"\n    - name: sci-m\n      path: "@grnsft/if-models"\n      model: SciMModel\n    - name: sci-o\n      model: SciOModel\n      path: "@grnsft/if-models"\n    - name: sci\n      model: SciModel\n      path: "@grnsft/if-models"\ngraph:\n  children:\n    server: # an advanced grouping node\n      pipeline:\n        - teads-curve\n        - sci-e\n        - sci-m\n        - sci-o\n        - sci\n      config:\n        sci:\n          functional_unit_duration: 1 \n          functional_duration_time: \'\'\n          functional_unit: requests # factor to convert per time to per f.unit\n      children:\n        nested-1:\n          inputs:\n            - timestamp: 2023-07-06T00:00\n              duration: 10\n              cpu-util: 50\n              thermal-design-power: 65\n              e-net: 0.000811 #kwh     \n              requests: 380\n              total-embodied-emissions: 251000 # gCO2eq\n              time-reserved: 3600 # 1 hour in s\n              expected-lifespan: 126144000 # 4 years in seconds    \n              resources-reserved: 1 \n              total-resources: 1\n              grid-carbon-intensity: 451\n        nested-2:\n          inputs: \n            - timestamp: 2023-07-06T00:00\n              duration: 10\n              cpu-util: 33\n              thermal-design-poiwer: 65\n              e-net: 0.000811 #kwh     \n              requests: 380\n              total-embodied-emissions: 251000 # gCO2eq\n              time-reserved: 3600 # 1 hour in s\n              expected-lifespan: 126144000 # 4 years in seconds    \n              resources-reserved: 1 \n              total-resources: 1\n              grid-carbon-intensity: 451\n\n')),(0,a.kt)("p",null,"In this way, you can combine complex model pipelines and application architectures to calculate the energy and carbon outputs of complicated systems."),(0,a.kt)("h2",{id:"choosing-which-models-to-run"},"Choosing which models to run"),(0,a.kt)("p",null,"The models are designed to be composable, but they each have specific input requirements that must be met in order for the models to run correctly. For example, the ",(0,a.kt)("inlineCode",{parentName:"p"},"teads-curve")," model requires ",(0,a.kt)("inlineCode",{parentName:"p"},"tdp")," to be available in the ",(0,a.kt)("inlineCode",{parentName:"p"},"impl"),". If it is not there, the model cannot use it to calculate ",(0,a.kt)("inlineCode",{parentName:"p"},"e-cpu"),"."),(0,a.kt)("p",null,"It is also possible to leapfrog some models if you have access to high-level data. For example, perhaps you already know the energy being used by your CPU. In this case, there is no need to run ",(0,a.kt)("inlineCode",{parentName:"p"},"teads-curve"),", you can simply provide ",(0,a.kt)("inlineCode",{parentName:"p"},"e-cpu")," as an ",(0,a.kt)("inlineCode",{parentName:"p"},"input")," and omit ",(0,a.kt)("inlineCode",{parentName:"p"},"teads-curve")," from the model pipeline."),(0,a.kt)("p",null,"We have deliberately made the models modular and composable so that you can be creative in developing new plugins to replace those provided as part of IF."),(0,a.kt)("h2",{id:"running-an-impl"},"Running an ",(0,a.kt)("inlineCode",{parentName:"h2"},"impl")),(0,a.kt)("p",null,"You run an ",(0,a.kt)("inlineCode",{parentName:"p"},"impl")," by providing its path to our command line tool and a path to save the results file to. You can run an ",(0,a.kt)("inlineCode",{parentName:"p"},"impl")," named ",(0,a.kt)("inlineCode",{parentName:"p"},"my-impl.yml")," using the following command:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"npx ts-node scripts/impact.ts --impl ./examples/impls/my-impl.yml --ompl ./examples/ompls/my-ompl.yml\n")))}d.isMDXComponent=!0}}]);