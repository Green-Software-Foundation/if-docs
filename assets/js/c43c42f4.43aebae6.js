"use strict";(self.webpackChunkgreen_software_training=self.webpackChunkgreen_software_training||[]).push([[44],{4137:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>d});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var u=n.createContext({}),s=function(e){var t=n.useContext(u),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},p=function(e){var t=s(e.components);return n.createElement(u.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,u=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),c=s(a),d=r,h=c["".concat(u,".").concat(d)]||c[d]||m[d]||i;return a?n.createElement(h,o(o({ref:t},p),{},{components:a})):n.createElement(h,o({ref:t},p))}));function d(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=c;var l={};for(var u in t)hasOwnProperty.call(t,u)&&(l[u]=t[u]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var s=2;s<i;s++)o[s]=a[s];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},7751:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>u,contentTitle:()=>o,default:()=>m,frontMatter:()=>i,metadata:()=>l,toc:()=>s});var n=a(7462),r=(a(7294),a(4137));const i={author:"Joseph Cook (@jmcook1186)",abstract:"Guidance for using the Azure importer."},o="Importing data from Azure",l={unversionedId:"tutorials/how-to-use-azure-vm",id:"tutorials/how-to-use-azure-vm",title:"Importing data from Azure",description:"The Azure importer model allows you to provide some basic details about an Azure virtual machine and automatically populate your impl with usage metrics that can then be passed along a model pipeline to calculate energy and carbon impacts.",source:"@site/docs/06-tutorials/how-to-use-azure-vm.md",sourceDirName:"06-tutorials",slug:"/tutorials/how-to-use-azure-vm",permalink:"/tutorials/how-to-use-azure-vm",draft:!1,editUrl:"https://github.com/Green-Software-Foundation/ief/docs/06-tutorials/how-to-use-azure-vm.md",tags:[],version:"current",frontMatter:{author:"Joseph Cook (@jmcook1186)",abstract:"Guidance for using the Azure importer."},sidebar:"tutorialSidebar",previous:{title:"how-to-import-models",permalink:"/tutorials/how-to-import-models"},next:{title:"IMPL writing guide",permalink:"/tutorials/how-to-write-impls"}},u={},s=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"First, you need to have a VM instance running on Azure",id:"first-you-need-to-have-a-vm-instance-running-on-azure",level:3},{value:"Next, Provide an Azure identity for the IEF Azure Importer to access Azure VM metadata and observability metrics",id:"next-provide-an-azure-identity-for-the-ief-azure-importer-to-access-azure-vm-metadata-and-observability-metrics",level:3},{value:"Create An App registration/service principal for the Azure Importer",id:"create-an-app-registrationservice-principal-for-the-azure-importer",level:3},{value:"Provide IAM access rights for the service principal to Query Azure VM info",id:"provide-iam-access-rights-for-the-service-principal-to-query-azure-vm-info",level:3},{value:"On your local machine, add the service principal credentials ENV vars to Azure Importer",id:"on-your-local-machine-add-the-service-principal-credentials-env-vars-to-azure-importer",level:3},{value:"Inputs",id:"inputs",level:2},{value:"Outputs",id:"outputs",level:2}],p={toc:s};function m(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"importing-data-from-azure"},"Importing data from Azure"),(0,r.kt)("p",null,"The Azure importer model allows you to provide some basic details about an Azure virtual machine and automatically populate your ",(0,r.kt)("inlineCode",{parentName:"p"},"impl")," with usage metrics that can then be passed along a model pipeline to calculate energy and carbon impacts."),(0,r.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("h3",{id:"first-you-need-to-have-a-vm-instance-running-on-azure"},"First, you need to have a VM instance running on Azure"),(0,r.kt)("p",null,"You can create one using ",(0,r.kt)("a",{parentName:"p",href:"https://portal.azure.com"},"portal.azure.com"),". You also need to create a metrics application for that virtual machine and assign the relevant permissions."),(0,r.kt)("h3",{id:"next-provide-an-azure-identity-for-the-ief-azure-importer-to-access-azure-vm-metadata-and-observability-metrics"},"Next, Provide an Azure identity for the IEF Azure Importer to access Azure VM metadata and observability metrics"),(0,r.kt)("p",null,"The Azure Importer uses ",(0,r.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/dotnet/api/azure.identity.defaultazurecredential?view=azure-dotnet"},"AzureDefaultCredentials","(",")")," method which is an abstraction for different scenarios of authentication"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"When hosting the IEF Azure Importer on an Azure service, you can provide a ",(0,r.kt)("a",{parentName:"li",href:"https://learn.microsoft.com/en-us/entra/identity/managed-identities-azure-resources/overview"},"managed identity"),"."),(0,r.kt)("li",{parentName:"ul"},"When running the Azure Importer outside of Azure, e.g on your local machine, you can use an ",(0,r.kt)("a",{parentName:"li",href:"https://learn.microsoft.com/en-us/entra/identity-platform/quickstart-register-app"},"App registration")," (an App registration is a represenation of a technical service principal account ; you can view it as an identity for your App on Azure).")),(0,r.kt)("p",null,"The following steps in this tutorial use a service principal. You can learn more on ",(0,r.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/entra/identity-platform/quickstart-register-app"},"https://learn.microsoft.com/en-us/entra/identity-platform/quickstart-register-app")),(0,r.kt)("h3",{id:"create-an-app-registrationservice-principal-for-the-azure-importer"},"Create An App registration/service principal for the Azure Importer"),(0,r.kt)("p",null,"On the Azure Portal, search for ",(0,r.kt)("strong",{parentName:"p"},"App registrations"),", then create new one with default values.\n",(0,r.kt)("img",{parentName:"p",src:"https://github.com/Green-Software-Foundation/if-docs/assets/966110/f77fd653-4386-4f4b-9488-ea7ae521d7d1",alt:"image"})),(0,r.kt)("p",null,"Then create a credential secret for this App registration, to use it for authenication with the Azure Importer => note that secret\n",(0,r.kt)("img",{parentName:"p",src:"https://github.com/Green-Software-Foundation/if-docs/assets/966110/c3f380e1-2bc9-471f-b212-ce8c31a158b1",alt:"image"})),(0,r.kt)("p",null,"Then, on the Overview Tab, copy/paste the ",(0,r.kt)("strong",{parentName:"p"},"client_id")," and ",(0,r.kt)("strong",{parentName:"p"},"tenant_id")," for this App registration\n",(0,r.kt)("img",{parentName:"p",src:"https://github.com/Green-Software-Foundation/if-docs/assets/966110/e1615088-9ee6-41ef-a340-7ab72c1bc488",alt:"image"})),(0,r.kt)("p",null,"Now we have credentials to authenticate to azure as the service principal (of this App registration)"),(0,r.kt)("h3",{id:"provide-iam-access-rights-for-the-service-principal-to-query-azure-vm-info"},"Provide IAM access rights for the service principal to Query Azure VM info"),(0,r.kt)("p",null,"next, we need to provide access rights to this service principal to the test VM (or its ressource group)."),(0,r.kt)("p",null,"On the IAM Tab of the Ressource Group that contains the VM, add new Role Assignment"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://github.com/Green-Software-Foundation/if-docs/assets/966110/0588530c-bd67-4876-b26b-c076d5cda08d",alt:"image"})),(0,r.kt)("p",null,"We'll need 2 role Assignments:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Reader"),(0,r.kt)("li",{parentName:"ul"},"Monitor Reader")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://github.com/Green-Software-Foundation/if-docs/assets/966110/52af6111-dde3-4f99-8739-769d72fdb5d8",alt:"image"})),(0,r.kt)("p",null,"Then Add the service principal you created as a member for the Role assignment\n",(0,r.kt)("img",{parentName:"p",src:"https://github.com/Green-Software-Foundation/if-docs/assets/966110/be097243-66a7-421a-9cee-e8fe77906a82",alt:"image"})),(0,r.kt)("p",null,"Repeat for the the role Monior Reader\n",(0,r.kt)("img",{parentName:"p",src:"https://github.com/Green-Software-Foundation/if-docs/assets/966110/5bf34f7a-9a01-4eb8-b3a4-aed70db44e72",alt:"image"})),(0,r.kt)("h3",{id:"on-your-local-machine-add-the-service-principal-credentials-env-vars-to-azure-importer"},"On your local machine, add the service principal credentials ENV vars to Azure Importer"),(0,r.kt)("p",null,"you should create a ",(0,r.kt)("inlineCode",{parentName:"p"},".env")," file in the IF project root directory. This is where you can store your Azure authentication details. Your ",(0,r.kt)("inlineCode",{parentName:"p"},".env")," file should look as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-txt"},"AZURE_TENANT_ID: <your-tenant-id>\nAZURE_CLIENT_ID: <your-client-id> \nAZURE_CLIENT_SECRET: <your-client-secret>\n")),(0,r.kt)("h2",{id:"inputs"},"Inputs"),(0,r.kt)("p",null,"All that remains is to provide the details about your virtual machine in the ",(0,r.kt)("inlineCode",{parentName:"p"},"inputs")," field in your ",(0,r.kt)("inlineCode",{parentName:"p"},"impl"),".\nThese are the required fields:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"timestamp"),": An ISO8601 timestamp indicating the start time for your observation period. We work out your ",(0,r.kt)("inlineCode",{parentName:"li"},"timespan")," by adding ",(0,r.kt)("inlineCode",{parentName:"li"},"duration")," to this initial start time."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"duration"),": Number of seconds your observation period should last. We add this number of seconds to ",(0,r.kt)("inlineCode",{parentName:"li"},"timestamp")," to work out when your observation period should stop."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"azure-observation-window"),": The time interval between measurements (temporal resolution) as a string with a value and a unit, e.g. ",(0,r.kt)("inlineCode",{parentName:"li"},"5 mins"),". The value and unit must be space-separated. "),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"azure-observation-aggregation"),": This indicates how you want metrics to be aggregated between each ",(0,r.kt)("inlineCode",{parentName:"li"},"interval"),". The recommended default is ",(0,r.kt)("inlineCode",{parentName:"li"},"average"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"azure-subscription-id"),": Your Azure subscription ID, e.g. 9cf5e19b-8b18-4c37-9541-55fc47ad70c3"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"azure-resource-group"),": Your Azure resource group name"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"azure-vm-name"),": Your virtual machine name")),(0,r.kt)("p",null,"These are all provided as ",(0,r.kt)("inlineCode",{parentName:"p"},"inputs"),". You also need to instantiate an ",(0,r.kt)("inlineCode",{parentName:"p"},"azure-importer")," model to handle the Azure-specific ",(0,r.kt)("inlineCode",{parentName:"p"},"input")," data. Here's what a complete ",(0,r.kt)("inlineCode",{parentName:"p"},"impl")," could look like:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"name: azure-demo\ndescription: example impl invoking Azure model\ninitialize:\n  models:\n    - name: azure-importer\n      kind: builtin\ngraph:\n  children:\n    child:\n      pipeline:\n        - azure-importer\n      config:\n        azure-importer:\n      inputs:\n          - timestamp: '2023-11-02T10:35:31.820Z'\n            duration: 3600\n            azure-observation-window: 5 min  \n            azure-observation-aggregation: 'average'\n            azure-subscription-id: 9cf5e19b-8b18-4c37-9541-55fc47ad70c3\n            azure-resource-group: my_group\n            azure-vm-name: my_vm\n")),(0,r.kt)("p",null,"This will grab Azure metrics for ",(0,r.kt)("inlineCode",{parentName:"p"},"my_vm")," in ",(0,r.kt)("inlineCode",{parentName:"p"},"my_group")," for a one hour period beginning at 10:35 UTC on 2nd November 2023, at 5 minute resolution, aggregating data occurring more frequently than 5 minutes by averaging. "),(0,r.kt)("h2",{id:"outputs"},"Outputs"),(0,r.kt)("p",null,"The Azure importer model will enrich your ",(0,r.kt)("inlineCode",{parentName:"p"},"impl")," with the following data:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"duration"),": the per-input duration in seconds, calculated from ",(0,r.kt)("inlineCode",{parentName:"li"},"azure-observation-window")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"cpu-util"),": percentage CPU utilization"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"cloud-instance-type"),": VM instance name"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"location"),": VM region"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"mem-availableGB"),": Amount of memory ",(0,r.kt)("em",{parentName:"li"},"not")," in use by your application, in GB."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"mem-usedGB"),": Amount of memory being used by your application, in GB. Calculated as the difference between ",(0,r.kt)("inlineCode",{parentName:"li"},"total-memoryGB")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"memory-availableGB"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"total-memoryGB"),": The total memory allocated to your virtual machine, in GB."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"mem-util"),": memory utilized, expressed as a percentage (",(0,r.kt)("inlineCode",{parentName:"li"},"memory-usedGB"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"total-memoryGB")," * 100)")),(0,r.kt)("p",null,"These can be used as inputs in other models in the pipeline. Typically, the ",(0,r.kt)("inlineCode",{parentName:"p"},"instance-type")," can be used to obtain ",(0,r.kt)("inlineCode",{parentName:"p"},"tdp")," data that can then, along with ",(0,r.kt)("inlineCode",{parentName:"p"},"cpu-util"),", feed a model such as ",(0,r.kt)("inlineCode",{parentName:"p"},"teads-curve"),". "),(0,r.kt)("p",null,"The outputs look as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"outputs:\n  - timestamp: '2023-11-02T10:35:00.000Z'\n    duration: 300\n    cpu-util: '0.314'\n    mem-availableGB: 0.488636416\n    mem-usedGB: 0.5113635839999999\n    total-memoryGB: '1'\n    mem_util: 51.13635839999999\n    location: uksouth\n    cloud-instance-type: Standard_B1s\n  - timestamp: '2023-11-02T10:40:00.000Z'\n      duration: 300\n    cpu-util: '0.314'\n    mem-availableGB: 0.48978984960000005\n    mem-usedGB: 0.5102101504\n    total-memoryGB: '1'\n    mem_util: 51.021015039999995\n    location: uksouth\n    cloud-instance-type: Standard_B1s\n...\n")))}m.isMDXComponent=!0}}]);