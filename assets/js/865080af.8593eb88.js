"use strict";(self.webpackChunkgreen_software_training=self.webpackChunkgreen_software_training||[]).push([[447],{4137:(e,n,t)=>{t.d(n,{Zo:()=>d,kt:()=>u});var i=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function r(e,n){if(null==e)return{};var t,i,a=function(e,n){if(null==e)return{};var t,i,a={},o=Object.keys(e);for(i=0;i<o.length;i++)t=o[i],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)t=o[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var p=i.createContext({}),s=function(e){var n=i.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},d=function(e){var n=s(e.components);return i.createElement(p.Provider,{value:n},e.children)},m={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},c=i.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,p=e.parentName,d=r(e,["components","mdxType","originalType","parentName"]),c=s(t),u=a,h=c["".concat(p,".").concat(u)]||c[u]||m[u]||o;return t?i.createElement(h,l(l({ref:n},d),{},{components:t})):i.createElement(h,l({ref:n},d))}));function u(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,l=new Array(o);l[0]=c;var r={};for(var p in n)hasOwnProperty.call(n,p)&&(r[p]=n[p]);r.originalType=e,r.mdxType="string"==typeof e?e:a,l[1]=r;for(var s=2;s<o;s++)l[s]=t[s];return i.createElement.apply(null,l)}return i.createElement.apply(null,t)}c.displayName="MDXCreateElement"},5641:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>l,default:()=>m,frontMatter:()=>o,metadata:()=>r,toc:()=>s});var i=t(7462),a=(t(7294),t(4137));const o={author:"Joseph Cook (@jmcook1186)",abstract:"Guidance for writing valid impls."},l="IMPL writing guide",r={unversionedId:"tutorials/how-to-write-impls",id:"tutorials/how-to-write-impls",title:"IMPL writing guide",description:"The Impact Framework receives all its configuration and input data in the form of a yaml file known as an impl (input-yaml).",source:"@site/docs/06-tutorials/how-to-write-impls.md",sourceDirName:"06-tutorials",slug:"/tutorials/how-to-write-impls",permalink:"/tutorials/how-to-write-impls",draft:!1,editUrl:"https://github.com/Green-Software-Foundation/TODO/docs/06-tutorials/how-to-write-impls.md",tags:[],version:"current",frontMatter:{author:"Joseph Cook (@jmcook1186)",abstract:"Guidance for writing valid impls."},sidebar:"tutorialSidebar",previous:{title:"Importing data from Azure",permalink:"/tutorials/how-to-use-azure-vm"},next:{title:"This is a file",permalink:"/folder/file"}},p={},s=[{value:"Structure of an <code>impl</code>",id:"structure-of-an-impl",level:2},{value:"<code>initialize</code>",id:"initialize",level:2},{value:"<code>graph</code>",id:"graph",level:2},{value:"<code>inputs</code>",id:"inputs",level:2},{value:"More complex <code>impls</code>",id:"more-complex-impls",level:2},{value:"Complex pipelines",id:"complex-pipelines",level:3},{value:"Complex applications",id:"complex-applications",level:3},{value:"Choosing which models to run",id:"choosing-which-models-to-run",level:2},{value:"Running an <code>impl</code>",id:"running-an-impl",level:2}],d={toc:s};function m(e){let{components:n,...t}=e;return(0,a.kt)("wrapper",(0,i.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"impl-writing-guide"},"IMPL writing guide"),(0,a.kt)("p",null,"The Impact Framework receives all its configuration and input data in the form of a ",(0,a.kt)("inlineCode",{parentName:"p"},"yaml")," file known as an ",(0,a.kt)("inlineCode",{parentName:"p"},"impl")," (input-yaml).\nTo use the framework, a user only has to write an ",(0,a.kt)("inlineCode",{parentName:"p"},"impl")," file and pass its path to the command line tool. This guide will help you to understand how to construct an ",(0,a.kt)("inlineCode",{parentName:"p"},"impl")," and use it to measure the energy and carbon usage of your app."),(0,a.kt)("h2",{id:"structure-of-an-impl"},"Structure of an ",(0,a.kt)("inlineCode",{parentName:"h2"},"impl")),(0,a.kt)("p",null,"The basic structure of an ",(0,a.kt)("inlineCode",{parentName:"p"},"impl")," is very simple. "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"name: \ndescription: \ntags: \ninitialize:\n  models:\n    - name: \n      kind: \n      verbose: \n      path: \ngraph:\n  children:\n    child:\n      pipeline:\n        - \n      config:\n      inputs:\n")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"impl")," starts with some metadata about the project, specifically:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"name")," "),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"description")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"tags"),". ")),(0,a.kt)("p",null,"There is no strict specfication for how these field are used; they are for you to keep track of your impls and to provide the necessary details for other users to understand your use case."),(0,a.kt)("h2",{id:"initialize"},(0,a.kt)("inlineCode",{parentName:"h2"},"initialize")),(0,a.kt)("p",null,"The next field is ",(0,a.kt)("inlineCode",{parentName:"p"},"initialize"),". This is where you specify each individual model that will be instantiated in your pipeline. The models can be initialized in any order. Models cannot be invoked elsewhere in the ",(0,a.kt)("inlineCode",{parentName:"p"},"impl")," if they have not been initialized by including them in this field. Models are initialized by providing their name and some configuration data. For example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"initialize:\n    - name: sci-m\n      kind: builtin\n      verbose: false\n      path: ''\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"name")," has to be precisely the model name recognized by IEF. You can check all the valid model names ",(0,a.kt)("a",{parentName:"p",href:"../src/util/models-universe.ts"},"here"),".\n",(0,a.kt)("inlineCode",{parentName:"p"},"kind")," determines whether the model is one of IEF's built-in models, or whether the model is some external code being executed in a spawned shell. The options are ",(0,a.kt)("inlineCode",{parentName:"p"},"builtin")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"shell"),". ",(0,a.kt)("inlineCode",{parentName:"p"},"verbose")," determines how much information should be added to the output file. This is not yet implemented as shoudl default to ",(0,a.kt)("inlineCode",{parentName:"p"},"false"),". ",(0,a.kt)("inlineCode",{parentName:"p"},"path")," is used for models run in a spawned shell. It should be the path to an executable."),(0,a.kt)("h2",{id:"graph"},(0,a.kt)("inlineCode",{parentName:"h2"},"graph")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"graph")," is where you define the various components of your application. ",(0,a.kt)("inlineCode",{parentName:"p"},"graph")," is organized into ",(0,a.kt)("inlineCode",{parentName:"p"},"children"),". Each ",(0,a.kt)("inlineCode",{parentName:"p"},"child")," is a component whose outputs should be summed to give the overall impact of your ",(0,a.kt)("inlineCode",{parentName:"p"},"graph"),". ",(0,a.kt)("inlineCode",{parentName:"p"},"children")," can be nested with arbitrary depth. Each ",(0,a.kt)("inlineCode",{parentName:"p"},"child")," can have its own model pipeline and its own config. When no config is provided, it is inherited from the ",(0,a.kt)("inlineCode",{parentName:"p"},"graph")," level config."),(0,a.kt)("p",null,"In the following example, there is only one component. The model pipeline contains two models, ",(0,a.kt)("inlineCode",{parentName:"p"},"teads-curve")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"sci-m"),". ",(0,a.kt)("inlineCode",{parentName:"p"},"teads-curve")," requires the ",(0,a.kt)("inlineCode",{parentName:"p"},"tdp")," to be defined in ",(0,a.kt)("inlineCode",{parentName:"p"},"config")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"sci-m")," requires five pieces of ",(0,a.kt)("inlineCode",{parentName:"p"},"config")," data: ",(0,a.kt)("inlineCode",{parentName:"p"},"total-embodied-emissions"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"time-reserved"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"expected-lifespan"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"resources-reserved")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"total-resources"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"graph:\n  children:\n    child:\n      pipeline:\n        - teads-curve\n        - sci-m\n      config:\n        teads-curve:\n          tdp: 55\n        sci-m:\n          total-embodied-emissions: 1533.12\n          time-reserved: 1\n          expected-lifespan: 3\n          resources-reserved: 1\n          total-resources: 8\n\n")),(0,a.kt)("h2",{id:"inputs"},(0,a.kt)("inlineCode",{parentName:"h2"},"inputs")),(0,a.kt)("p",null,"Each ",(0,a.kt)("inlineCode",{parentName:"p"},"child")," has its own set of ",(0,a.kt)("inlineCode",{parentName:"p"},"inputs"),". These are the most granular data, each of which are associated with a specific timestamp. Every ",(0,a.kt)("inlineCode",{parentName:"p"},"input")," must always include a ",(0,a.kt)("inlineCode",{parentName:"p"},"timestamp")," and a ",(0,a.kt)("inlineCode",{parentName:"p"},"duration"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"inputs:\n  - timestamp: 2023-07-06T00:00\n    duration: 3600\n    cpu-util: 45\n")),(0,a.kt)("p",null,"That's it! You now have a simple ",(0,a.kt)("inlineCode",{parentName:"p"},"impl")," file that will use the model config and input data to run the ",(0,a.kt)("inlineCode",{parentName:"p"},"teads-curve")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"sci-m")," models! The output data will be appended to the ",(0,a.kt)("inlineCode",{parentName:"p"},"impl")," under a new ",(0,a.kt)("inlineCode",{parentName:"p"},"outputs")," field and saved as an ",(0,a.kt)("inlineCode",{parentName:"p"},"ompl")," file."),(0,a.kt)("h2",{id:"more-complex-impls"},"More complex ",(0,a.kt)("inlineCode",{parentName:"h2"},"impls")),(0,a.kt)("h3",{id:"complex-pipelines"},"Complex pipelines"),(0,a.kt)("p",null,"The basic ",(0,a.kt)("inlineCode",{parentName:"p"},"impl")," in the previous section is valid, but it is minimal and doesn't return very interesting output data. We expect most users will want to calculate an SCI score, which requires both ",(0,a.kt)("inlineCode",{parentName:"p"},"operational-carbon")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"embodied-carbon")," as inputs, which requires ",(0,a.kt)("inlineCode",{parentName:"p"},"sci")," to be preceded by ",(0,a.kt)("inlineCode",{parentName:"p"},"sci-m")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"sci-o")," in the model pipeline. In most cases, ",(0,a.kt)("inlineCode",{parentName:"p"},"sci-o")," will have to be preceded by ",(0,a.kt)("inlineCode",{parentName:"p"},"sci-e")," to ensure ",(0,a.kt)("inlineCode",{parentName:"p"},"energy")," is available to be piped to ",(0,a.kt)("inlineCode",{parentName:"p"},"sci-o"),". And, most likely, the inputs to ",(0,a.kt)("inlineCode",{parentName:"p"},"sci-e")," will be coming from a model such as ",(0,a.kt)("inlineCode",{parentName:"p"},"teads-curve"),". The ",(0,a.kt)("inlineCode",{parentName:"p"},"sci")," model also requires ",(0,a.kt)("inlineCode",{parentName:"p"},"functional-unit")," information so it can convert the estimated ",(0,a.kt)("inlineCode",{parentName:"p"},"carbon")," into a useful unit."),(0,a.kt)("p",null,"An example of a complex pipeline that executes all these model sin sequence is:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"name: full-sci\ndescription: example executing a full pipeline from teads --\x3e sci\ntags:\ninitialize:\n  models:\n    - name: teads-curve\n      kind: builtin\n    - name: sci-m\n      kind: builtin\n    - name: sci-o\n      kind: builtin\n    - name: sci-e\n      kind: builtin\n    - name: sci\n      kind: builtin\ngraph:\n  children:\n    child:\n      pipeline:\n        - teads-curve\n        - sci-m\n        - sci-e\n        - sci-o\n        - sci\n      config:\n        teads-curve:\n          tdp: 55\n        sci-m:\n          te: 1533.12\n          tir: 1\n          el: 3\n          rr: 1\n          tor: 8\n        sci-o:\n          grid-ci: 1500     \n        sci:\n          functional_unit_duration: 1 \n          functional_unit_time: 'minutes'\n          functional_unit: requests # factor to convert per time to per f.unit\n      inputs:\n        - timestamp: 2023-07-06T00:00\n          duration: 1\n          cpu-util: 55\n          requests: 100\n\n")),(0,a.kt)("h3",{id:"complex-applications"},"Complex applications"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"impl")," examples provided so far have only had a single component. However, IEF can handle any number of ",(0,a.kt)("inlineCode",{parentName:"p"},"children")," that can be nested.\nThe following snippet shows how you can nest multiple subcomponents. "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"name: nesting-demo\ndescription:\ntags:\n  kind: web\n  complexity: moderate\n  category: on-premise\ninitialize:\n  models:\n    - name: teads-curve\n      kind: builtin\n    - name: sci-e\n      kind: builtin\n      verbose: false\n      path: ''\n    - name: sci-m\n      kind: builtin\n      verbose: false\n      path: ''\n    - name: sci-o\n      kind: builtin\n      verbose: false\n      path: ''\n    - name: sci\n      kind: builtin\n      verbose: false\n      path: ''\ngraph:\n  children:\n    server: # an advanced grouping node\n      pipeline:\n        - teads-curve\n        - sci-e\n        - sci-m\n        - sci-o\n        - sci\n      config:\n        teads-curve:\n          tdp: 65\n        sci-m:\n          te: 251000 # gCO2eq\n          tir: 3600 # 1 hour in s\n          el: 126144000 # 4 years in seconds    \n          rr: 1 \n          tor: 1 \n        sci-o:\n          grid-ci: 457 # gCO2/kwh\n        sci:\n          functional_unit_duration: 1 \n          functional_duration_time: ''\n          functional_unit: requests # factor to convert per time to per f.unit\n      children:\n        nested-1:\n          inputs:\n            - timestamp: 2023-07-06T00:00\n              duration: 10\n              cpu-util: 50\n              e-net: 0.000811 #kwh     \n              requests: 380\n        nested-2:\n          inputs: \n            - timestamp: 2023-07-06T00:00\n              duration: 10\n              cpu-util: 33\n              e-net: 0.000811 #kwh     \n              requests: 380 \n\n")),(0,a.kt)("p",null,"You can combine complex model pipelines and complex application architectures to calculate the energy and carbon outputs of complicated systems!"),(0,a.kt)("h2",{id:"choosing-which-models-to-run"},"Choosing which models to run"),(0,a.kt)("p",null,"The models are designed to be composable, but they each have specific input requirements that must be met in order for the models to run correctly. For example, teh ",(0,a.kt)("inlineCode",{parentName:"p"},"teads-curve")," model requires ",(0,a.kt)("inlineCode",{parentName:"p"},"tdp")," to be available in the ",(0,a.kt)("inlineCode",{parentName:"p"},"impl"),". If it is not there, the model cannot use it to calculate ",(0,a.kt)("inlineCode",{parentName:"p"},"e-cpu"),". You can refer to the ",(0,a.kt)("a",{parentName:"p",href:"/models/"},"individual model documentation")," to see the parameters and return values for each model. "),(0,a.kt)("p",null,"it is also possible to leapfrog some models if you have access to high-level data. For example, perhaps you already know the energy being used by your CPU. In this case, there is no need to run ",(0,a.kt)("inlineCode",{parentName:"p"},"teads-curve"),", you can simply provide ",(0,a.kt)("inlineCode",{parentName:"p"},"e-cpu")," as an ",(0,a.kt)("inlineCode",{parentName:"p"},"input")," and omit ",(0,a.kt)("inlineCode",{parentName:"p"},"teads-curve")," from the model pipeline."),(0,a.kt)("p",null,"We have deliberately made the models modular and composable so that you can be creative in developing new plugins to replace those provided as part of IEF."),(0,a.kt)("h2",{id:"running-an-impl"},"Running an ",(0,a.kt)("inlineCode",{parentName:"h2"},"impl")),(0,a.kt)("p",null,"You run an impl by providing its path to our command line tool, along with a path to save the results file to. You can run an ",(0,a.kt)("inlineCode",{parentName:"p"},"impl")," named ",(0,a.kt)("inlineCode",{parentName:"p"},"my-impl.yml")," as follows:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"npx ts-node scripts/impact.ts --impl ./examples/impls/my-impl.yml --ompl ./examples/ompls/my-ompl.yml\n")))}m.isMDXComponent=!0}}]);